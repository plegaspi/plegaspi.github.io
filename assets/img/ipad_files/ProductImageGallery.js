usingNamespace("Biz.Product")["Product360Viewer"] = (function ($) {$.fn.productViewer = function (options) {options = $.extend({spin: ".range",zoomAdd: ".zoom .add",zoomSub: ".zoom .sub",zoomReset: ".zoom .reset",speed: 1, /*旋转速度 */currentImage: 1, /*当前图片*/imageCount: 20, /*图片总数量*/baseName: "images/z3d/small/images ", /*图片baseurl*/imageType: ".jpg", /*图片类型*/width: 640,   /*初始化图片宽*/height: 500,  /*初始化图片高*/maxZoomCount: 2, /*最大请求服务器放大次数*/maxLocalZoomCount: 2, /* 本地最大放大次数*/zoomTime: 1.5, /*放大倍数*/zoomSpeed: 400,forceSize: false, /*强制设置图片的大小为容器的宽度*/isSpin: true /*是否支持360*/}, options);if (options.imageCount == 0) return;var $imagePanel = this.find(".image-panel"),$spin = this.find(options.spin),$zoomAdd = this.find(options.zoomAdd),$zoomSub = this.find(options.zoomSub),$zoomReset = this.find(options.zoomReset),$viewer = this;this.on("init_viewer:before", function () {show_loading();});this.on("init_viewer:end", function () {$viewer.find("#viewer_loading").hide();$viewerImage.show();});this.on("tool_enable:trigger", function () {$zoomAdd.prop("disabled", (zoomCount >= options.maxLocalZoomCount || zoomCount < 0));$zoomSub.prop("disabled", (zoomCount <= 0));$zoomReset.prop("disabled", (zoomCount == 0));});var wrapWitdh = $imagePanel.width(),wrapHeight = $imagePanel.height();var loaded = _initImages();var $viewerImage = $('<img />');$viewerImage.attr("src", _buildImageSrc(options.currentImage));if (options.forceSize) {$viewerImage.css({ "width": wrapWitdh, "height": wrapHeight });} else {offsetLeft = (wrapWitdh - options.width) / 2;offsetTop = (wrapHeight - options.height) / 2;}$viewerImage.hide();$viewerImage.appendTo($imagePanel);var zoomCount = 0,drag = false,move = false,position = { "x": 0, "y": 0 },offsetLeft = 0,offsetTop = 0,dragPackage = { "drag": false, "left": 0, "top": 0 };this.show();$imagePanel.show();if (!options.forceSize) {offsetLeft = (wrapWitdh - options.width) / 2;offsetTop = (wrapHeight - options.height) / 2;}$viewerImage.css({ "top": offsetTop, "left": offsetLeft });this.trigger("tool_enable:trigger");function _change(from, to) {if (from == to) return;var speed = options.speed,_loaded = loaded;window.setTimeout(function () {if (from != to) {/*console.log("from: " + from + ", to:" + to);*/if (from > to) {from = from - 1;} else {from = from + 1;}_loadedData = _loaded[from - 1];$viewerImage.attr("src", _loadedData.url);_change(from, to);}}, speed);};function _initImages() {var imageCount = options.imageCount;var iLoaded = 1;var _$viewer = $viewer;var width = options.width;var height = options.height;var imageQuery = _imageQuery(width, height);var loaded = [];var _isSpin = options.isSpin;if (!_isSpin) {$viewer.find(".spin").hide();$viewer.find(".zoom").css({ "margin-left": "245px" });} else {$viewer.find(".spin").show();$viewer.find(".zoom").css({ "margin-left": "50px" });}_$viewer.trigger("init_viewer:before");for (var i = 1; i <= imageCount; i++) {var oNewImg = new Image();oNewImg.onload = function () {if (++iLoaded == imageCount) {_$viewer.trigger("init_viewer:end");}};oNewImg.src = _buildImageSrc(i) + imageQuery;loaded[i - 1] = { "width": width, "height": height, "loadCount": 1, "url": oNewImg.src };}return loaded;};function _buildImageSrc(imageIndex) {var _options = options;if (_options.isSpin) {return _options.baseName + (imageIndex < 10 ? "0" + imageIndex : imageIndex) + _options.imageType;} else {return _options.baseName;}};function _imageQuery(width, height) {var hasWindow = window ? true : false;var isRetina = hasWindow ? window.devicePixelRatio > 1 : false;return "?w=" + width + "&h=" + height + (isRetina ? "&ex=2" : "");};function _resize(new_width, new_height, add) {var left = (wrapWitdh - new_width) / 2,top = (wrapHeight - new_height) / 2,_options = options;if (dragPackage.drag) {if (add) {left = dragPackage.left * _options.zoomTime;top = dragPackage.top * _options.zoomTime;} else {left = dragPackage.left / _options.zoomTime;top = dragPackage.top / _options.zoomTime;}dragPackage.left = left;dragPackage.top = top;}$viewerImage.animate({ "height": new_height, "width": new_width, "left": left, "top": top }, _options.zoomSpeed, function () {_change_current();});};function _change_current() {var $current = $viewerImage,width = $current.width(),height = $current.height(),_options = options,currentLoaded = loaded[_options.currentImage - 1];if (currentLoaded.loadCount > _options.maxZoomCount) {return;}if (currentLoaded.height < height || currentLoaded.width < width) {var oldSrc = $current.attr("src");var newImage = $current.clone()[0];var newSrc = oldSrc.substring(0, oldSrc.indexOf("?"));if (!newSrc) {console.log("new src: ", newSrc);return;}newImage.onload = _loadFun(_options.currentImage, width, height);if (currentLoaded.loadCount < _options.maxZoomCount - 1) {newSrc = newSrc + _imageQuery(width, height);}var hasWindow = window ? true : false;var isRetina = hasWindow ? window.devicePixelRatio > 1 : false;newSrc = newSrc + (isRetina ? ((newSrc.indexOf("?") > -1 ? "&" : "?") + "ex=2") : "");newImage.src = newSrc;currentLoaded.width = width;currentLoaded.height = height;currentLoaded.loadCount += 1;currentLoaded.url = newSrc;}};function _loadFun(currentImage, width, height) {return function () {if (currentImage == options.currentImage) {$viewerImage.attr("src", this.src);console.log("loaded new image");}};};$spin.attr("min", 1).attr("max", options.imageCount).val(options.currentImage);$spin.on("keyup, keydown", function () { return false });$spin.on("change", function () {var targetStep = parseInt(this.value);var currentStep = options.currentImage;_change(currentStep, targetStep);options.currentImage = targetStep;_change_current();});var timeID;$viewerImage.on("click", function () {timeID = setTimeout(function () {$zoomAdd.trigger("click");}, 100);});$viewerImage.on("dblclick", function () {clearTimeout(timeID);$zoomReset.trigger("click");});$zoomAdd.on("click", function () {if (zoomCount >= options.maxLocalZoomCount) {return;}var $img = $viewerImage,new_width = $img.width() * options.zoomTime,new_height = $img.height() * options.zoomTime;_resize(new_width, new_height, true);zoomCount++;$viewer.trigger("tool_enable:trigger");});$zoomSub.on("click", function () {if (zoomCount < 1)return;if (zoomCount == 1) {$zoomReset.trigger("click");return;}var $img = $viewerImage,new_width = $img.width() / options.zoomTime,new_height = $img.height() / options.zoomTime;_resize(new_width, new_height);zoomCount--;$viewer.trigger("tool_enable:trigger");});$zoomReset.on("click", function () {var _options = options;dragPackage.drag = false;var height, width;if (_options.forceSize) {height = wrapHeight;width = wrapWitdh;} else {height = _options.height;width = _options.width;}$viewerImage.animate({ "height": height, "width": width, "left": offsetLeft, "top": offsetTop }, _options.zoomSpeed);zoomCount = 0;$viewer.trigger("tool_enable:trigger");});function show_loading() {var _$viewer = $viewer;_$viewer.append();var $loading = _$viewer.find("#viewer_loading");if ($loading.length == 0) {$loading = $('<div id="viewer_loading" class="loading"><div class="loader"><i class="fa fa-spinner fa-pulse"></i>LOADING...</div></div>');_$viewer.append($loading);}$loading.show();};$imagePanel.on("mousedown", "img", function (event) {if (drag && moveabel()) {var wrapPos = $imagePanel.offset(),currentPos = $(this).position(),mousePos = getMousePos(event);position.x = mousePos.x - wrapPos.left - currentPos.left;position.y = mousePos.y - wrapPos.top - currentPos.top;$viewerImage.css("cursor", "move");move = true;}});$(document).on("mouseup", function () {move = false;$viewerImage.css("cursor", "");});$imagePanel.on("mouseover", "img", function () {drag = true;});$imagePanel.on("mousemove", "img", function (event) {mousePos = getMousePos(event),wrapPos = $imagePanel.offset();if (move && detectLeftButton(event) && moveabel()) {dragPackage.drag = true;dragPackage.top = mousePos.y - wrapPos.top - position.y;dragPackage.left = mousePos.x - wrapPos.left - position.x;$viewerImage.css({ "top": dragPackage.top, "left": dragPackage.left });} else {$viewerImage.css("cursor", "");}});function moveabel() {return zoomCount > 0;};$imagePanel.on("dragstart", function () {return false;});function getMousePos(e) {e = e || window.event;var x = e.pageX || (e.clientX + (document.documentElement.scrollLeft || document.body.scrollLeft));var y = e.pageY || (e.clientY + (document.documentElement.scrollTop || document.body.scrollTop));return { 'x': x, 'y': y };}function detectLeftButton(evt) {evt = evt || window.event;var button = evt.which || evt.button;return button == 1;}};})(jQuery);/*  Public Property: ShowHandler,Config*/usingNamespace("Biz.Product")["ImageGalleryManager"] = (function () {/* private  begin*/var _instance = null;var _isFlashCheckDone = false;var _isSupportFlash = true;var setConfig = function (key, value) {if (this.Config != null) {this.Config[key] = value;}};var initForImageGallery = function () {if (_instance == null) {getInstance.call(this, null);enableKeyupFunction();}};var enableKeyupFunction = function () {jQuery(document).keyup(function (e) {if (Biz.Product.ImageGalleryManager.IsShowing()) {if (e.which == 0x1B) {Biz.Product.ImageGalleryManager._Close();}if (e.which == 0x25) {if (Biz.Product.ImageGalleryManager.CanShowPreviousPic()) {Biz.Product.ImageGalleryManager._ShowPrevious();}else {Biz.Product.ImageGalleryManager._ShowLastPic();}}if (e.which == 0x27) {if (Biz.Product.ImageGalleryManager.CanShowNextPic()) {Biz.Product.ImageGalleryManager._ShowNext();}else {Biz.Product.ImageGalleryManager._ShowFirstPic();}}}});};var getInstance = function (arg) {if (this.Config == null)return null;switch (this.Config.Type) {case 1:_instance = new ItemImageGallery(this.Config);break;case 2:_instance = new NormalComboImageGallery(this.Config);break;case 3:_instance = new SuperComboImageGallery(this.Config);break;default:}};var extend = function (subClass, superClass) {var temp = function () {};temp.prototype = superClass.prototype;subClass.prototype = new temp();subClass.prototype.constructor = subClass;subClass.superclass = superClass.prototype;if (superClass.prototype.constructor == Object.prototype.constructor) {superClass.prototype.constructor = superClass;}};/*components begin*/var ControlBase = (function () {var constructor = function (config) {this.Config = config;};constructor.prototype.BuildImageUrl = function (url, s7folder, image) {var result;if (String.isNullOrEmpty(s7folder)) {result = url + image;} else {result = url + this.Config.ImageFolder + image + "?$" + s7folder + "$";}return result;};return constructor;})();var ComboBarContol = (function () {var constructor = function (config) {ControlBase.call(this, config);};extend(constructor, ControlBase);constructor.prototype.Build = function () {var result = document.createElement("ul");result.id = "segProductList";result.className = "segment";result.style.display = "none";return result;};constructor.prototype.Render = function () {var config = this.Config;var combo = "";if (config._isSuperCombo)combo = this.renderCombo();var items = this.renderItems();var temp = jQuery("#GalleryContainer2011 #segProductList");temp.html(combo + items);temp.css("display", "");};constructor.prototype.renderCombo = function () {var config = this.Config;var sb = new Sys.Text.StringBuilder();sb.appendLine("<li id='itemLink0' class='current' >");var title = config.comboName;sb.appendLine("<a id='link0' class='blockLinkSi' href=\"javascript:Biz.Product.ImageGalleryManager._ShiftItem({i:0});\" title='" + config.comboName + "'>");var src = (config.comboImage.toUpperCase().indexOf(".JPG") == -1) ? this.BuildImageUrl(config.BaseUrlForS7, config.S60, config.comboImage) : this.BuildImageUrl(config._SmallImageUrl, "", config.comboImage);sb.appendLine("<img src='" + src + "' title='" + title + "' alt='" + title + "'/>");sb.appendLine("</a>");sb.appendLine("</li>");return sb.toString();};constructor.prototype.renderItems = function () {var config = this.Config;var sb = new Sys.Text.StringBuilder();var items = config.Items;var length = config.Items.length;var title, json, temp;for (var i = 0; i < length; i++) {temp = i + 1;sb.appendLine("<li id=itemLink" + temp + " >");title = items[i].imageTitle;json = "{i:" + temp + ",Item:'" + items[i].itemNumber + "'}";sb.appendLine("<a id='link" + temp + "' class='blockLinkSi' href=\"javascript:Biz.Product.ImageGalleryManager._ShiftItem(" + json + ");\" title='" + title + "'>");sb.appendLine("<img src='" + this.getItemSrc(items[i]) + "'  title='" + title + "' alt='" + title + "' />");sb.appendLine("</a>");sb.appendLine("</li>");};return sb.toString();};constructor.prototype.getItemSrc = function (item) {var result;var config = this.Config;var temp;switch (item.imageType) {case "Scene7":if (!String.isNullOrEmpty(item.scene7ImageInfo.vendorSetImageList)) {temp = item.scene7ImageInfo.vendorSetImageList.split(',');} else {temp = item.scene7ImageInfo.imageSetImageList.split(',');}result = this.BuildImageUrl(config.BaseUrlForS7, config.S60, temp[0]);break;case "SpecialScene7":temp = item.scene7ImageInfo.specialImageList.split(',');result = this.BuildImageUrl(config.BaseUrlForS7, config.S60, temp[0]);break;case "Normal":temp = item.normalImageInfo.imageNameList.split(",");result = this.BuildImageUrl(config._SmallImageUrl, "", temp[0]);break;default:}return result;};constructor.prototype.Show = function (showConfig) {var id;if (String.isNullOrEmpty(showConfig.id) && String.isNullOrEmpty(showConfig.Item)) {id = 0;} else if (!String.isNullOrEmpty(showConfig.Item)) {var length = this.Config.Items.length;var items = this.Config.Items;for (var i = 0; i < length; i++) {if (items[i].itemNumber == showConfig.Item) {id = i + 1;break;}}}jQuery("#GalleryContainer2011 #segProductList li").removeClass();jQuery("#GalleryContainer2011 #segProductList #itemLink" + id).addClass("current");};return constructor;})();var ProductTitleControl = (function () {var constructor = function (config) {ControlBase.call(this, config);};extend(constructor, ControlBase);constructor.prototype.Build = function () {var result = document.createElement("h1");result.id = "segProductTitle";result.className = "segment";result.style.display = "none";return result;};constructor.prototype.Render = function () {jQuery("#segProductTitle").css("display", "");var config = this.Config;if (config._isSuperCombo) {if (config._currentItem != null) {jQuery("#segProductTitle").html(config._currentItem.imageTitle);} else {jQuery("#segProductTitle").html(config.comboName);};} else {jQuery("#segProductTitle").html(config._currentItem.imageTitle);};};return constructor;})();var DisclaimerControl = (function () {var constructor = function (config) {ControlBase.call(this, config);};extend(constructor, ControlBase);constructor.prototype.Build = function () {var result = document.createElement("div");result.id = "segDisclaimer";result.className = "segment";result.style.display = "none";return result;};constructor.prototype.Render = function () {var currentItem = this.Config._currentItem;if (currentItem == null) {jQuery("#segDisclaimer").css("display", "none");} else {var itemType = currentItem.itemType;if (itemType.isOpenBoxItem) {jQuery("#segDisclaimer").html(this.Config.openboxDesc);jQuery("#segDisclaimer").css("display", "");} else if (itemType.isRecertifiedItem) {jQuery("#segDisclaimer").html(this.Config.recertifiedDesc);jQuery("#segDisclaimer").css("display", "");} else {jQuery("#segDisclaimer").css("display", "none");};};};return constructor;})();var MainViewControl = (function () {var constructor = function (config) {ControlBase.call(this, config);this._builded = false;};extend(constructor, ControlBase);constructor.prototype.Build = function () {var config = this.Config;var result = document.createElement("div");result.id = "widViewer";result.className = "widget";var slideLeft = document.createElement("div");slideLeft.id = "segSlideLeft";slideLeft.className = "slideControl";var ngBoxPrev = "";if (config.NG_BOX_Prev) {ngBoxPrev = config.NG_BOX_Prev;}slideLeft.innerHTML = "<a title='Previous Image' " + ngBoxPrev + " class='blockLinkSi' href='javascript:Biz.Product.ImageGalleryManager._ShowPrevious();'><img alt='Previous Image' src='" + config.blankImgSrc + "' /></a>";var galleryDFIS = document.createElement("div");galleryDFIS.id = "galleryDFIS";galleryDFIS.className = "product-panel";galleryDFIS.style.display = "none";var ngBoxZoomIn = "", ngBoxZoomOut = "", ngBoxZoomReset = "";if (config.NG_BOX_ZoomIn) {ngBoxZoomIn = config.NG_BOX_ZoomIn;}if (config.NG_BOX_ZoomOut) {ngBoxZoomOut = config.NG_BOX_ZoomOut;}if (config.NG_BOX_ZoomReset) {ngBoxZoomReset = config.NG_BOX_ZoomReset;}galleryDFIS.innerHTML = "<div class='image-panel' id='DFIS360View'></div><div class='tool-panel'><div class='spin'><label>Spin</label> <input class='range' type='range'  id='image-range' value='1' min='1' max='24'></div><div class='zoom'><label>Zoom</label> <input class='add' type='button' " + ngBoxZoomIn + "  id='add' value='+'><input " + ngBoxZoomOut + " class='sub' type='button'  id='sub' value='-'><input class='reset' " + ngBoxZoomReset + " type='button'  id='reset' value='Reset'></div></div>";var galleryFlash = document.createElement("div");galleryFlash.id = "galleryFlash";galleryFlash.style.display = "none";galleryFlash.innerHTML = "<div class='showImgCur' id='izView'></div><div id='i360View' style='display: none;'></div>";var galleryDHTML = document.createElement("div");galleryDHTML.id = "galleryDHTML";galleryDHTML.style.display = "none";galleryDHTML.innerHTML = "<div class='showImgCur' style='width:640px;' id='CurImg'><img id='CurrentImage' name='CurrentImage'/></div>";var slideRight = document.createElement("div");slideRight.id = "segSlideRight";slideRight.className = "slideControl";var ngBoxNext = "";if (config.NG_BOX_Next) {ngBoxNext = config.NG_BOX_Next;}slideRight.innerHTML = "<a title='Next Image' " + ngBoxNext + " class='blockLinkSi' href='javascript:Biz.Product.ImageGalleryManager._ShowNext();'><img alt='Next Image' src='" + config.blankImgSrc + "' /></a>";result.appendChild(slideLeft);result.appendChild(galleryDFIS);result.appendChild(galleryFlash);result.appendChild(galleryDHTML);result.appendChild(slideRight);return result;};constructor.prototype.render = function () {this.buildHtml(this.Config._currentImgId);};constructor.prototype.buildHtml = function (id, title) {var title_force;if (id == null || id < 0) {title_force = this.Config.comboName;} else {title_force = !String.isNullOrEmpty(title) ? title.trim() : this.Config._currentItem.imageTitle.trim();};jQuery("#galleryDFIS").css("display", "none");jQuery("#galleryFlash").css("display", "none");jQuery("#galleryDHTML").css("display", "");var str = " alt='" + title_force + "' title='" + title_force + "'/>";var html = jQuery("#CurImg").html();if (!String.isNullOrEmpty(html)) {if (html.indexOf(">") != -1) {jQuery("#CurrentImage").attr("alt", title_force);jQuery("#CurrentImage").attr("title", title_force);};};this.Show(id);};constructor.prototype.Show = function (imageId) {var config = this.Config;if (!this._builded) {this._builded = true;this.render();};if (imageId > -1 && config._picType == "DFIS") {jQuery("#galleryDFIS").css("display", "");jQuery("#galleryFlash").css("display", "none");jQuery("#galleryDHTML").css("display", "none");this.buildDFIS(imageId);}else if (imageId > -1 && config._picType == "Flash") {jQuery("#galleryDFIS").css("display", "none");jQuery("#galleryFlash").css("display", "");jQuery("#galleryDHTML").css("display", "none");this.buildFlash(imageId);} else {var imageSrc;if (config._currentItem == null && config._isSuperCombo) {imageSrc = this.BuildImageUrl(config.BaseUrlForNonS7, "", config.comboImage);} else {imageSrc = this.BuildImageUrl(config._BaseUrl, config._showS7ViaHtml ? config._S640 : "", config._Images[imageId - 1]);};var hasWindow = window ? true : false;var isRetina = hasWindow ? window.devicePixelRatio > 1 : false;if (isRetina) {jQuery("#CurrentImage").attr("width", jQuery("#CurrentImage").parent().width());jQuery("#CurrentImage").attr("src", imageSrc + (imageSrc.indexOf("?") > -1 ? "&" : "?") + "ex=2");}else {jQuery("#CurrentImage").attr("src", imageSrc);}jQuery("#galleryDFIS").css("display", "none");jQuery("#galleryFlash").css("display", "none");jQuery("#galleryDHTML").css("display", "");};this.setNavigationButton();this.renderThirdparty(imageId, config);};constructor.prototype.buildDFIS = function (imageId) {var config = this.Config;var player, itemBase, item, type;var isSpin = (Object.isNull(imageId) || imageId <= 0);var _baseName = "";if (isSpin) {/* http://image10.image.com/productimage1280/12-345-678_R01.jpg *//* "http://neg-app-img/testgroup/testtype/30-120-741-R";*/_baseName = this.BuildImageUrl(config._Base360Url, "", config._currentItem.normalImageInfo.dfis360ImgFlag.replace("_RY", "_R"));} else {_baseName = this.BuildImageUrl(config._BaseUrl, "", config._Images[imageId - 1]);}jQuery("#DFIS360View").html("");jQuery('.product-panel').each(function () {jQuery(this).productViewer({baseName: _baseName,width: 660,height: 500,maxZoomCount: 1,maxLocalZoomCount: 2,isSpin: isSpin,loadingUrl: config.loadingUrl,forceSize: true});});};constructor.prototype.setNavigationButton = function () {var config = this.Config;var isShowPre = jQuery("#imageIndex0").length > 0 && jQuery("#imageIndex0").css("display") != "none" ? (config._currentImgId > 0) : (config._currentImgId > 1);var isShowNext = config._currentImgId < config._imagesCount && config._currentImgId > -1;jQuery("#segSlideLeft").css("visibility", isShowPre ? "visible" : "hidden");jQuery("#segSlideRight").css("visibility", isShowNext ? "visible" : "hidden");};constructor.prototype.buildFlash = function (id) {var config = this.Config;var player, itemBase, item, type;var isSpin = (Object.isNull(id) || id <= 0);itemBase = config._BaseUrl + '&contentRoot=' + config.flashContentRoot + '&image=' + config.ImageFolder;if (isSpin) {if (String.isNullOrEmpty(config._SpinSetName)) {if (!String.isNullOrEmpty(config._Images[0]) && config._currentImgId < 1) {config._currentImgId = 1;return this.buildFlash(1);};};item = itemBase + config._SpinSetName + config.spinPlayerSettings;player = config.spinPlayer;type = "_spin";} else {item = itemBase + config._Images[id - 1] + config.zoomPlayerSettings;player = config.zoomPlayer;type = "_zoom";};var so = new SWFObject(player, "integratedViewerLoader" + type, "660", "535", config.minVersion);so.addParam("quality", "high");so.addParam("wmode", "transparent");var flashVarString = "serverUrl=" + item;var flashVarPairs = flashVarString.split("&");if (flashVarPairs.length > 0) {for (var i = 0; i < flashVarPairs.length; i++) {var nv = flashVarPairs[i].split("=");if (nv.length == 2) {so.addVariable(nv[0], nv[1]);};};};if (!isSpin) {if (jQuery("#izView").length > 0) {so.write("izView");jQuery("#izView").css("display", "");jQuery("#i360View").css("display", "none");}} else {if (jQuery("#i360View").length > 0) {so.write("i360View");jQuery("#izView").css("display", "none");jQuery("#i360View").css("display", "");};};};constructor.prototype.renderThirdparty = function (id, config) {if (id === 0) {Biz.Common.SiteCatalyst.send({ 'events': 'event46', 'products': config._Item }, '360 Rotational View Click');}};return constructor;})();var ComboDescControl = (function () {var constructor = function (config) {ControlBase.call(this, config);};extend(constructor, ControlBase);constructor.prototype.Build = function () {var result = document.createElement("div");result.id = "comboDesc";result.style.display = "none";result.innerHTML = this.Config.ComboDescText;return result;};constructor.prototype.Show = function () {jQuery("#GalleryContainer2011 #comboDesc").css("display", "");};constructor.prototype.Hide = function () {jQuery("#GalleryContainer2011 #comboDesc").css("display", "none");};return constructor;})();var ImageListControl = (function () {var constructor = function (config) {ControlBase.call(this, config);};extend(constructor, ControlBase);constructor.prototype.Build = function () {var result = document.createElement("ul");result.id = "segImageList";result.className = "segment";return result;};constructor.prototype.Select = function (imageId) {jQuery("#segImageList li[id^=imageIndex]").removeClass();jQuery("#imageIndex" + imageId).addClass("current");};constructor.prototype.Render = function () {var currentItem = this.Config._currentItem;switch (currentItem.imageType) {case "Scene7":this.renderS7Thumbnails(currentItem.imageTitle);break;case "SpecialScene7":this.renderNonS7Thumbnails(currentItem.imageTitle);break;case "Normal":if (currentItem.isDFISImage) {this.renderS7Thumbnails(currentItem.imageTitle);} else {this.renderNonS7Thumbnails(currentItem.imageTitle);}break;default:}};constructor.prototype.renderS7Thumbnails = function (title) {var config = this.Config;var result = "";jQuery("#segImageList").empty();if ((config._picType == "Flash" && !String.isNullOrEmpty(config._SpinSetName)) || (config._picType == "DFIS" && !String.isNullOrEmpty(config._dfis360ImgFlag))) {jQuery("#segImageList").append(this.buildS7Thumbnails(config._SpinSetName, 0, "_ShiftImage", title, true));};if (config._imagesCount > 0 && !String.isNullOrEmpty(config._Images[0])) {if (config._picType == "DFIS") {for (var i = 0; i < config._imagesCount; i++) {jQuery("#segImageList").append(this.buildNonS7Thumbnails(config._Images[i], i + 1, "_ShiftImage", title, false));};} else {for (var i = 0; i < config._imagesCount; i++) {jQuery("#segImageList").append(this.buildS7Thumbnails(config._Images[i], (i + 1), "_ShiftImage", title, false));};}};this.Select(config._currentImgId);};constructor.prototype.buildS7Thumbnails = function (n, id, fn, title, is360) {var config = this.Config;var result = document.createElement("li");result.id = "imageIndex" + id;var html;var  ng_box = "";if (config.NG_BOX_Sub) {ng_box = config.NG_BOX_Sub;}if (is360) {var imgTitle = "360 Degree Rotational View";html = "<a id='threesixty' class='blockLinkSi' "+ ng_box +" href='javascript:Biz.Product.ImageGalleryManager." + fn + "(" + id + ");'  title='" + id + "'>";html += "<img src='" + config.blankImgSrc + "' height='45' width='60' title='" + imgTitle + "' alt='" + imgTitle + "'/></a>";}else {html = "<a class='blockLinkSi' " + ng_box + " href='javascript:Biz.Product.ImageGalleryManager." + fn + "(" + id + ");'  title='" + id + "'>";html += "<img src='" + this.BuildImageUrl(config._BaseUrl, config.S60, n) + "' height='45' width='60' title='" + title + "' alt='" + title + "'/></a>";};result.innerHTML = html;return result;};constructor.prototype.renderNonS7Thumbnails = function (title) {var config = this.Config;var result = "";jQuery("#segImageList").empty();if (config._imagesCount > 0 && !String.isNullOrEmpty(config._Images[0])) {for (var i = 0; i < config._imagesCount; i++) {jQuery("#segImageList").append(this.buildNonS7Thumbnails(config._Images[i], i + 1, "_ShiftImage", title, false));};};this.Show(config._currentImgId);};constructor.prototype.buildNonS7Thumbnails = function (n, id, fn, title, is360) {var config = this.Config;var result = document.createElement("li");result.id = "imageIndex" + id;var ng_box = "";if (config.NG_BOX_Sub) {ng_box = config.NG_BOX_Sub;}var html,imgUrl="";imgUrl = config._showS7ViaHtml ? this.BuildImageUrl(config._BaseUrl, config.S60, n) : this.BuildImageUrl(config._SmallImageUrl, "", n);html = "<a class='blockLinkSi' " + ng_box + " href='javascript:Biz.Product.ImageGalleryManager." + fn + "(" + id + ")' title='" + id + "'>";html += "<img src='" + imgUrl + "' height='45' width='60' title='" + title.trim() + "' alt='" + title.trim() + "'/></a>";result.innerHTML = html;return result;};constructor.prototype.Hide = function () {jQuery("#segImageList").css("display", "none");};constructor.prototype.Show = function () {jQuery("#segImageList").css("display", "");};return constructor;})();var ImageGalleryBase = (function () {var constructor = function (config) {ControlBase.call(this, config);this._mask = null;this._builded = false;this._controls = {};this._renderedPosition = false;this._lastRenderedPos = {};};constructor.prototype.Show = function (showConfig) {this.processShowConfig.call(this, showConfig);if (!this._builded) {this.build.call(this);this._builded = true;};this._mask.className = "GalleryContainer2011Mask_on";this.renderPosition();this._controls.disclaimer.Render();this.renderThirdparty(showConfig);};constructor.prototype.renderPosition = function (forceRenderPosition) {var gallery = jQuery("#GalleryContainer2011");gallery.css("display", "");var left, top, tempScrollTop, tempHeight;if (!this._renderedPosition || forceRenderPosition) {left = (document.body.clientWidth - 964) / 2;tempScrollTop = document.documentElement.scrollTop > 0 ? document.documentElement.scrollTop : document.body.scrollTop;tempHeight = jQuery("#GalleryContainer2011")[0].clientHeight + 8;var temp = 7;if (Web.Environment.Browser.isIE()) {if (Web.Environment.Browser.currentVersion() == Web.Enum.Browser.IE_7) {temp = 7;}else {temp = 0;}} else {temp = 7;}top = (document.body.clientHeight > tempHeight) ? (tempScrollTop + (document.body.clientHeight - tempHeight - 8) / 2 + temp) : (tempScrollTop + 8);this._renderedPosition = true;this._lastRenderedPos.Left = left;this._lastRenderedPos.Top = top;} else {left = this._lastRenderedPos.Left;top = this._lastRenderedPos.Top;}gallery.css("top", top);gallery.css("left", left > 0 ? left : 0);};constructor.prototype.processShowConfig = function (showConfig) {var config = this.Config;this._renderedPosition = !(showConfig._isShow != null && showConfig);config._isSuperCombo = !String.isNullOrEmpty(config.comboName);config._Item = showConfig.Item;config._SmallImageUrl = config.SmallImageUrl;config._S640 = config.S640;config._currentItem = null;if (!String.isNullOrEmpty(config._Item)) {for (var i = 0; i < config.Items.length; i++) {if (config.Items[i].itemNumber == config._Item) {config._currentItem = config.Items[i];break;};};};var currentItem = config._currentItem;if (currentItem != null) {switch (currentItem.imageType) {case "Scene7":config._BaseUrl = config.BaseUrlForS7;var vendorImageNames = currentItem.scene7ImageInfo.vendorSetImageList ? (currentItem.scene7ImageInfo.vendorSetImageList.rTrim(",") + ",") : "";config._Images = (vendorImageNames + currentItem.scene7ImageInfo.imageSetImageList.rTrim(",")).trim(",").split(",");config._SpinSetName = currentItem.scene7ImageInfo.spinSetName;if (Biz.Product.ImageGalleryManager._IsSupportFlash()) {config._picType = "Flash";config._showS7ViaHtml = false;} else {config._picType = "Static";config._showS7ViaHtml = true;config._currentImgId = (config._currentImgId > -1) ? 1 : -1;};break;case "SpecialScene7":config._BaseUrl = config.BaseUrlForS7;config._picType = "Static";config._showS7ViaHtml = true;config._Images = currentItem.scene7ImageInfo.specialImageList.rTrim(",").split(",");break;case "Normal":if (currentItem.isDFISImage) {if (currentItem.hasWaterMark) {config._Base360Url = config.BaseUrl1280For360ViewW;config._BaseUrl = config.BaseUrl1280ForNonS7W;config._S640 = config.S640W;config._SmallImageUrl = config.SmallImageUrlW;} else {config._Base360Url = config.BaseUrl1280For360View;config._BaseUrl = config.BaseUrl1280ForNonS7;config._S640 = config.S640;config._SmallImageUrl = config.SmallImageUrl;}config._picType = "DFIS";config._Images = currentItem.normalImageInfo.imageNameList.rTrim(",").split(",");config._showS7ViaHtml = false;} else {if (currentItem.hasWaterMark) {config._BaseUrl = config.BaseUrlForNonS7W;config._S640 = config.S640W;config._SmallImageUrl = config.SmallImageUrlW;} else {config._BaseUrl = config.BaseUrlForNonS7;config._S640 = config.S640;config._SmallImageUrl = config.SmallImageUrl;}config._picType = "Static";config._Images = currentItem.normalImageInfo.imageNameList.rTrim(",").split(",");config._showS7ViaHtml = false;}break;default:};config._imagesCount = config._Images.length;config._SpinSetName = (currentItem.scene7ImageInfo != null) ? currentItem.scene7ImageInfo.spinSetName : "";config._dfis360ImgFlag = (currentItem.normalImageInfo != null) ? currentItem.normalImageInfo.dfis360ImgFlag : "";config._currentImgId = (config._picType == "Flash" && (!String.isNullOrEmpty(config._SpinSetName))) || (config._picType == "DFIS" && !String.isNullOrEmpty(config._dfis360ImgFlag)) ? 0 : 1;if (config._Images.length > 0 && !String.isNullOrEmpty(config._Images[0])) {for (var j = 0; j < config._Images.length; j++) {if (config._Images[j] == showConfig.CurImage) {config._currentImgId = j + 1;break;};};};};};constructor.prototype.ShiftImage = function (imageId) {this.Config._currentImgId = imageId;this._controls.mainView.Show(imageId);if (imageId > -1)this._controls.imageList.Select(imageId);};constructor.prototype.ShowPrevious = function () {var config = this.Config;if (config._currentImgId > 0)this.ShiftImage.call(this, config._currentImgId - 1);};constructor.prototype.ShowNext = function () {var config = this.Config;if (config._currentImgId < config._imagesCount)this.ShiftImage.call(this, config._currentImgId + 1);};constructor.prototype.Close = function () {this._mask.className = "GalleryContainer2011Mask_off";jQuery("#GalleryContainer2011").css("display", "none");};constructor.prototype.build = function () {this._builded = true;this._mask = this.buildMask();var baseGallery = document.createElement("div");baseGallery.id = "GalleryContainer2011";baseGallery.setAttribute("tracking-module", "Image Gallery");var title = document.createElement("span");title.innerHTML = "<img src='" + this.Config.blankImgSrc + "' ><span>Image Gallery</span>";title.className = "containertitle";var content = document.createElement("div");content.className = "maincontent";var controls = this.buildControls.call(this);for (var i = 0; i < controls.order.length; i++)content.appendChild(controls.order[i].Build());var footer = document.createElement("div");footer.className = "galleryFooter";footer.innerHTML = "<a href='javascript:void(0);' onclick='Biz.Product.ImageGalleryManager._Close()'>close window</a>";baseGallery.appendChild(title);baseGallery.appendChild(this.buildBtnClose());baseGallery.appendChild(content);baseGallery.appendChild(footer);document.body.appendChild(this._mask);document.body.appendChild(baseGallery);jQuery(window).resize(function () {var gallery = document.getElementById("GalleryContainer2011");if (gallery != null && gallery.style.display != "none") {var left = (document.body.clientWidth - 964) / 2;gallery.style.left = (left > 0 ? left : 0) + "px";var tempScrollTop = document.documentElement.scrollTop > 0 ? document.documentElement.scrollTop : document.body.scrollTop;var tempHeight = gallery.clientHeight + 8;var temp = 7;if (Web.Environment.Browser.isIE()) {if (Web.Environment.Browser.currentVersion() == Web.Enum.Browser.IE_7) {temp = 7;}else {temp = 0;}} else {temp = 7;}var top = (document.body.clientHeight > tempHeight) ? (tempScrollTop + (document.body.clientHeight - tempHeight - 8) / 2 + temp) : (tempScrollTop + 8);gallery.style.top = top + "px";Biz.Product.ImageGalleryManager._CurrentGallery()._lastRenderedPos.Left = left;Biz.Product.ImageGalleryManager._CurrentGallery()._lastRenderedPos.Top = top;}});};constructor.prototype.buildControls = function () {var result = {};var config = this.Config;var order = [];result.comboBar = new ComboBarContol(config);order.push(result.comboBar);result.productTitle = new ProductTitleControl(config);order.push(result.productTitle);result.disclaimer = new DisclaimerControl(config);order.push(result.disclaimer);result.mainView = new MainViewControl(config);order.push(result.mainView);result.comboDesc = new ComboDescControl(config);order.push(result.comboDesc);result.imageList = new ImageListControl(config);order.push(result.imageList);result.order = order;this._controls = result;return result;};constructor.prototype.buildMask = function () {var mask = document.createElement("div");mask.className = "GalleryContainer2011Mask_off";mask.onclick = function () { Biz.Product.ImageGalleryManager._Close(); };return mask;};constructor.prototype.buildBtnClose = function () {var btnClose = document.createElement("a");btnClose.className = "galleryBtnClose";var img = document.createElement("img");img.alt = "close window";img.src = this.Config.blankImgSrc;btnClose.onclick = function () { Biz.Product.ImageGalleryManager._Close(); };btnClose.appendChild(img);return btnClose;};constructor.prototype.ShowFirstPic = function () {if (this.Config._picType == "Flash" && !String.isNullOrEmpty(this.Config._SpinSetName)) {this.ShiftImage(0);}else {this.ShiftImage(1);}};constructor.prototype.ShowLastPic = function () {if (this.Config._imagesCount > 0)this.ShiftImage(this.Config._imagesCount);};constructor.prototype.renderThirdparty = function (showConfig) {Biz.Common.SiteCatalyst.send({ 'events': 'event45', 'products': showConfig.Item }, 'Image Gallery Click');};return constructor;})();/*components end*/var ItemImageGallery = (function () {var constructor = function (config) {this.typeName = "ItemImageGallery";ImageGalleryBase.call(this, config);};extend(constructor, ImageGalleryBase);constructor.prototype.Show = function (showConfig) {showConfig._isShow = true;this.constructor.superclass.Show.call(this, showConfig);this._controls.imageList.Render();this.ShiftImage.call(this, this.Config._currentImgId);if (jQuery(".OverlaylcThumbs").length > 0 && jQuery("#OverlaylcWrap").length > 0 && jQuery("#segImageList").length > 0) {jQuery(".OverlaylcThumbs").insertAfter("#segImageList");jQuery("#OverlaylcWrap").insertAfter("#segImageList");jQuery(".OverlaylcThumbs").show();}this.renderPosition(true);};return constructor;})();var NormalComboImageGallery = (function () {var constructor = function (config) {this.typeName = "NormalComboImageGallery";ImageGalleryBase.call(this, config);};extend(constructor, ImageGalleryBase);constructor.prototype.Show = function (showConfig) {showConfig._isShow = true;this.constructor.superclass.Show.call(this, showConfig);this._controls.comboBar.Render();this._controls.productTitle.Render();this._controls.imageList.Render();this._controls.comboBar.Show(showConfig);this.ShiftImage.call(this, this.Config._currentImgId);if (jQuery(".OverlaylcThumbs").length > 0 && jQuery("#OverlaylcWrap").length > 0 && jQuery("#segImageList").length > 0) {jQuery(".OverlaylcThumbs").insertAfter("#segImageList");jQuery("#OverlaylcWrap").insertAfter("#segImageList");jQuery(".OverlaylcThumbs").show();}this.renderPosition(true);};constructor.prototype.ShiftItem = function (showConfig) {this.constructor.superclass.Show.call(this, showConfig);this._controls.comboBar.Show(showConfig);this._controls.productTitle.Render();this._controls.imageList.Render();this.ShiftImage.call(this, this.Config._currentImgId);if (jQuery(".OverlaylcThumbs").length > 0 && jQuery("#OverlaylcWrap").length > 0 && jQuery("#segImageList").length > 0) {jQuery(".OverlaylcThumbs").insertAfter("#segImageList");jQuery("#OverlaylcWrap").insertAfter("#segImageList");jQuery(".OverlaylcThumbs").show();}};return constructor;})();var SuperComboImageGallery = (function () {var constructor = function (config) {this.typeName = "SuperComboImageGallery";ImageGalleryBase.call(this, config);};extend(constructor, ImageGalleryBase);constructor.prototype.Show = function (showConfig) {showConfig._isShow = true;this.constructor.superclass.Show.call(this, showConfig);this._controls.comboBar.Render();this._controls.productTitle.Render();if (String.isNullOrEmpty(showConfig.Item)) {this._controls.comboDesc.Show();this.ShiftImage.call(this, -1);this._controls.imageList.Hide();} else {this._controls.comboDesc.Hide();this._controls.imageList.Render();this._controls.imageList.Show();this.ShiftImage.call(this, this.Config._currentImgId);if (jQuery(".OverlaylcThumbs").length > 0 && jQuery("#OverlaylcWrap").length > 0 && jQuery("#segImageList").length > 0) {jQuery(".OverlaylcThumbs").insertAfter("#segImageList");jQuery("#OverlaylcWrap").insertAfter("#segImageList");jQuery(".OverlaylcThumbs").show();}};this._controls.comboBar.Show(showConfig);this.renderPosition(true);};constructor.prototype.ShiftItem = function (showConfig) {constructor.superclass.Show.call(this, showConfig);this._controls.comboBar.Show(showConfig);this._controls.productTitle.Render();if (String.isNullOrEmpty(showConfig.Item)) {this._controls.comboDesc.Show();this.ShiftImage.call(this, -1);this._controls.imageList.Hide();} else {this._controls.comboDesc.Hide();this._controls.imageList.Render();this._controls.imageList.Show();this.ShiftImage.call(this, this.Config._currentImgId);if (jQuery(".OverlaylcThumbs").length > 0 && jQuery("#OverlaylcWrap").length > 0 && jQuery("#segImageList").length > 0) {jQuery(".OverlaylcThumbs").insertAfter("#segImageList");jQuery("#OverlaylcWrap").insertAfter("#segImageList");jQuery(".OverlaylcThumbs").show();}};};return constructor;})();/* private  end*//* public  begin*/var res = {};res.Show = function (showConfig) {if (typeof showConfig.Condition == "undefined") {var openBoxDesc = jQuery('#main-item-ig').html();Biz.Product.ImageGalleryManager.Config.openboxDesc = openBoxDesc;}if (typeof showConfig.Condition == "boolean" && showConfig.Condition) {var itemNumber = showConfig.Item;var hiddenItems = jQuery('#' + itemNumber).text().trim();var items = JSON.parse(hiddenItems);var itemsArr = Biz.Product.ImageGalleryManager.Config.Items;var itemNumbersArr = [];for (var i = 0; i < itemsArr.length; i++) {itemNumbersArr.push(itemsArr[i].itemNumber);}if (itemNumbersArr.indexOf(itemNumber) < 0) {itemsArr.push(items[0]);}Biz.Product.ImageGalleryManager.Config.openboxDesc = "";}initForImageGallery.call(this, null);if (_instance != null)_instance.Show(showConfig);/*hook*/if (this.ShowHandler != null) {this.ShowHandler(showConfig);}};res.IsShowing = function () {if (jQuery("#GalleryContainer2011").css("display") != "none" || jQuery("#GalleryContainer").css("display") != "none") {return true;}return false;};res._ShiftItem = function (showConfig) {if (_instance != null)_instance.ShiftItem(showConfig);};res._ShiftImage = function (imageId) {if (_instance != null)_instance.ShiftImage(imageId);};res._ShowNext = function () {if (_instance != null)_instance.ShowNext();};res._ShowPrevious = function () {if (_instance != null)_instance.ShowPrevious();};res._Close = function () {if (_instance != null)_instance.Close();};res._IsSupportFlash = function () {if (!_isFlashCheckDone) {_isFlashCheckDone = true;_isSupportFlash = Web.Plugin.Flash.isInstalled();}return _isSupportFlash;};res._CurrentGallery = function () {return _instance;};res.CanShowPreviousPic = function () {return jQuery("#segSlideLeft").css("visibility") != "hidden";};res.CanShowNextPic = function () {return jQuery("#segSlideRight").css("visibility") != "hidden";};res._ShowFirstPic = function () {_instance.ShowFirstPic();};res._ShowLastPic = function () {_instance.ShowLastPic();};return res;/* public  end*/})();