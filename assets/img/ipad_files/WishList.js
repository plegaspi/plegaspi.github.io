NEG.Module("Biz.Common.WishList", function (require) {var $ = require("NEG.ThirdParty.JQuery");var cookieUtility = require("Utility.Cookie");function WishList() {var flag_badWords = false;var flag_create_new = true;var $item_element;var requestUrl = Web.Config.Environment.Url.WWW + "Common/Ajax/WishListAjaxMiddlePage.aspx";var IsLogin = false;var init = function () {IsLogin = Web.StateManager.Cookies.get("NV_DVINFO", "s81") ? true : false;if (Biz.WishListModule == undefined) {return;}if (Biz.WishListModule.Config.EnableWishList2016 === "True") {$("#AddToWishlist_Content").append("<div class=\"wishlist-choose-list\"></div>");$("#AddToWishlist_Content .wishlist-choose-list").append(getTemplate("loading"));$("#AddToWishlist_Content").append("<div class=\"wishlist-back-info\"></div>");var excludePage = ["ProductCompare", "PointOfSale"];if ($.inArray(Biz.WishListModule.Config.PageAliase, excludePage) == -1 &&Biz.WishListModule.Config.ShowList != null &&Biz.WishListModule.Config.ShowList === "True") {getItemInListCount(renderItemInListCount);}if (IsLogin) {if (Biz.WishListModule.Config.PageAliase === "ProductCompare") {init4ComparePage();}bindPopupEvent();} else {$("a.wishlist.open-popup").removeClass('open-popup');$("a.wishlist").on("click", function () {window.location.href = Biz.WishListModule.Config.LoginLink;});}} else {$("a.wishlist.open-popup").removeClass('open-popup');$("a.wishlist").on("click", function () {window.location.href = Biz.WishListModule.Config.OldWishListLink;});}};var init4ComparePage = function () {$.each($("#AddToWishlist.open-popup"), function (a, b) {$.each(Biz.WishListModule.Config.CompareItemList, function (c, d) {if ($(b).attr("name") == d.ItemNumber) {$(b).data("iteminfo", d);}});});};var renderItemInListCount = function (data) {if (data && data.itemCount > 0) {var tempHtml = "";if (data.itemCount > 1) {tempHtml = "Found on " + "<strong>" + data.itemCount + "</strong>" + " wish lists";} else {tempHtml = "Found on " + "<strong>" + data.itemCount + "</strong>" + " wish list";}$('.item-wishlist .item-wishlist-num').append(tempHtml);}};var getItemInListCount = function (callback) {var requestData = {SubmitType: "GetItemInListCount",ItemNumber: $("#AddToWishlist").data("iteminfo").ItemNumber};$.ajax({type: "POST",xhrFields: {withCredentials: true},data: requestData,url: requestUrl,success: callback});};var getMyWishList = function (callback) {$.ajax({type: "GET",xhrFields: {withCredentials: true},url: requestUrl,success: callback});};var bindPopupEvent = function () {$("a.wishlist.open-popup").on("shown.ng.popup", function (e, api) {var $target = api.$target;var $element = $item_element = api.$element;var $source = api.$source;$target.find('.wishlist-choose-list').empty();$target.find('.wishlist-back-info').empty();$('.wishlist-choose-list').show().next('.wishlist-back-info').hide();if ($target.find('.wishlist-choose-list').is(':empty')) {$target.find('.wishlist-choose-list').append(getTemplate("loading"));}getMyWishList(renderStep1);});};var renderStep1 = function (data) {flag_create_new = data.length > 0 ? false : true;$(".centerPopup-body .wishlist-choose-list").empty();$.template("Step1Template", flag_create_new ? getTemplate("createNew") : getTemplate("chooseList"));$.tmpl("Step1Template", createStep1Data(data)).appendTo(".centerPopup-body .wishlist-choose-list");if (flag_create_new) {$(".centerPopup-body .wishlist-choose-list .form-cell.form-options.type").find("div.form-option-item").on('click', function () {$(".centerPopup-body .wishlist-choose-list .form-cell.form-options.type").find("div.form-option-item").removeClass('is-selected');$(this).addClass('is-selected');$(".centerPopup-body .wishlist-choose-list .form-cell.form-options.type").find('input[name="type"]').val($(this).data("type"));});$(".centerPopup-body .wishlist-choose-list .form-cell.form-options.privacy").find("div.form-option-item").on('click', function () {$(".centerPopup-body .wishlist-choose-list .form-cell.form-options.privacy").find("div.form-option-item").removeClass('is-selected');$(this).addClass('is-selected');$(".centerPopup-body .wishlist-choose-list .form-cell.form-options.privacy").find('input[name="privacy"]').val($(this).data("type"));});$('.centerPopup-body .wishlist-choose-list .centerPopup-button-area button').on('click', createMyWishList);} else {$('.centerPopup-body .wishlist-choose-list input[type=checkbox]').on('click', function () {if ($('.centerPopup-body .wishlist-choose-list').find('input[type=checkbox]:checked').length != 0) {$('.centerPopup-body .wishlist-choose-list').find(".form-checkbox-title").removeClass('error');return;}});$('.centerPopup-body .wishlist-choose-list .centerPopup-button-area button').on('click', saveToMyWishList);}};var createStep1Data = function (data) {var templateData = {lang: Biz.WishListModule.Config.Lang,list: data};return templateData;};var saveToMyWishList = function () {if ($('.centerPopup-body .wishlist-choose-list').find('.form-add-new input[type=checkbox]').is(':checked')) {if (!chk_required($('.centerPopup-body .wishlist-choose-list').find('.form-add-new-text'), 'input')) { return; };}if ($('.centerPopup-body .wishlist-choose-list').find('input[type=checkbox]:checked').length == 0) {$('.centerPopup-body .wishlist-choose-list').find(".form-checkbox-title").addClass('error');return;}$(".centerPopup-body .wishlist-back-info").append(getTemplate("loading"));$('.wishlist-choose-list').slideUp().next('.wishlist-back-info').slideDown();$.ajax({type: "POST",xhrFields: {withCredentials: true},url: requestUrl,data: buildRequestData(),success: renderStep2});};var createMyWishList = function () {if (!chk_required($('.centerPopup-body .wishlist-choose-list').find('.form-cell.layout-wide.title'), 'input')) {return};$(".centerPopup-body .wishlist-back-info").append(getTemplate("loading"));$('.wishlist-choose-list').slideUp().next('.wishlist-back-info').slideDown();var buildRequestData = function () {var data = {ItemNumber: $item_element.data("iteminfo").ItemNumber,Qty: $("#qtyMainItems").val() ? $("#qtyMainItems").val() : 1,NewCreateTitle: $(".centerPopup-body .wishlist-choose-list .form-cell.title").find('input').val(),IsPublic: $(".centerPopup-body .wishlist-choose-list .form-cell.privacy").find('input').val(),WishListType: $(".centerPopup-body .wishlist-choose-list .form-cell.type").find('input').val(),SubmitType: "CreateWishList"};return data;};$.ajax({type: "POST",xhrFields: {withCredentials: true},url: requestUrl,data: buildRequestData(),success: renderStep2});};var createStep2Data = function (data) {if (flag_badWords) {var templateData = {badWords: $('<textarea/>').html(data.badwords).text()};} else if (flag_create_new) {var templateData = {lang: Biz.WishListModule.Config.Lang,item: $item_element.data("iteminfo"),Title: data.title,WishListNumber: data.newWishListNumber,Link: Web.Config.Environment.Url.Secure + "Wishlist/MyWishlistDetail?ID=" + data.newWishListNumber};} else {var objList = $.map(data.wishLists, function (v) {var obj = {Title: v.title,WishListNumber: v.wishListNumber,Link: Web.Config.Environment.Url.Secure + "Wishlist/MyWishlistDetail?ID=" + v.wishListNumber};return obj;});var templateData = {lang: Biz.WishListModule.Config.Lang,item: $item_element.data("iteminfo"),list: objList};}return templateData;};var renderStep2 = function (data) {$(".centerPopup-body .wishlist-back-info").empty();flag_badWords = false;if (data.badwords) {flag_badWords = true;$.template("Step2Template", getTemplate("badWords"));$.tmpl("Step2Template", createStep2Data(data)).appendTo(".centerPopup-body .wishlist-back-info");} else {$.template("Step2Template", flag_create_new ? getTemplate("createNewBackInfo") : getTemplate("chooseListBackInfo"));$.tmpl("Step2Template", createStep2Data(data)).appendTo(".centerPopup-body .wishlist-back-info");}$('.wishlist-choose-list').slideUp().next('.wishlist-back-info').slideDown();$('.centerPopup-body .wishlist-back-info .centerPopup-button-area a').on('click', function () {window.location.href = Biz.WishListModule.Config.MyWishlistsLink;});};var getTemplate = function (template) {var loading ="<div class=\"centerPopup-420-content\">" +"<div class=\"popup-scroll-box body-scroll-fixed\">" +"<div class=\"form-cells\">" +"<div class=\"loader\">" +"<img src=\"" + Web.UI.ResourceManager.Image.build('loading16.gif') + "\" alt=\"LOADING...\">LOADING..." +"</div>" +"</div>" +"</div>";var chooseList ="<div class=\"centerPopup-title\">" +"<h2>${lang.AddToWishlist}</h2>" +"</div>" +"<div class=\"centerPopup-420-content\">" +"<div class=\"popup-scroll-box body-scroll-fixed\">" +"<div class=\"form-cells form-exist\">" +"{{each list}}" +"<div class=\"form-cell layout-wide\">" +"<label class=\"form-checkbox is-wide is-nowrap\">" +"<input type=\"checkbox\" name=\"exist\" value=\"${wishListNumber}\">" +"<span class=\"form-checkbox-title\">${title.encodeHtml()}</span>" +"</label>" +"</div>" +"{{/each}}" +"</div>" +"</div>" +"<div class=\"form-cells form-add-new\">" +"<div class=\"form-cell layout-wide\">" +"<label class=\"form-checkbox is-wide is-nowrap\">" +"<input type=\"checkbox\" name=\"new\">" +"<span class=\"form-checkbox-title\">${lang.NewWishList}</span>" +"</label>" +"<div class=\"form-add-new-text\">" +"<input type=\"text\" class=\"form-text is-wide\" maxlength=\"100\" placeholder=\"Enter a new wish list name\">" +"</div>" +"</div>" +"</div>" +"</div>" +"<div class=\"centerPopup-bottom\">" +"<div class=\"centerPopup-button-area\">" +"<button type=\"button\" class=\"btn btn-primary\">${lang.Add}</button>" +"</div>" +"</div>";var createNew ="<div class=\"centerPopup-title\">" +"<h2>Create a List</h2>" +"</div>" +"<div class=\"centerPopup-640-content\">" +"<div class=\"form-cells\">" +"<div class=\"form-cell layout-wide title\">" +"<label class=\"form-cell-name\">Name</label>" +"<input type=\"text\" class=\"form-text is-wide\" maxlength=\"100\" placeholder=\"New Wish List\">" +"</div>" +"<div class=\"form-cell layout-wide form-options type\">" +"<input type=\"hidden\" name=\"type\" value=\"1\">" +"<label class=\"form-cell-name\">Type</label>" +"<ul class=\"form-cells\">" +"<li class=\"form-cell layout-half\">" +"<div class=\"form-option-item is-selected\" data-type=\"1\">" +"<strong class=\"form-option-item-title\">Build List</strong>" +"<p class=\"form-option-item-note\">The easy way to plan your DIY computer.</p>" +"</div>" +"</li>" +"<li class=\"form-cell layout-half\">" +"<div class=\"form-option-item\" data-type=\"2\">" +"<strong class=\"form-option-item-title\">Shopping List</strong>" +"<p class=\"form-option-item-note\">General shopping list for everything else.</p>" +"</div>" +"</li>" +"</ul>" +"</div>" +"<div class=\"form-cell layout-wide form-options privacy\">" +"<input type=\"hidden\" name=\"privacy\" value=\"false\">" +"<label class=\"form-cell-name\">Privacy</label>" +"<ul class=\"form-cells\">" +"<li class=\"form-cell\">" +"<div class=\"form-option-item\" data-type=\"true\">" +"<strong class=\"form-option-item-title\">Public</strong>" +"</div>" +"</li>" +"<li class=\"form-cell\">" +"<div class=\"form-option-item is-selected\" data-type=\"false\">" +"<strong class=\"form-option-item-title\">Private</strong>" +"</div>" +"</li>" +"</ul>" +"</div>" +"</div>" +"</div>" +"<div class=\"centerPopup-bottom\">" +"<div class=\"centerPopup-button-area\">" +"<button type=\"button\" class=\"btn btn-primary\">Create &amp; Save</button>" +"</div>" +"</div>";var chooseListBackInfo ="<div class=\"centerPopup-title\">" +"<h2>${lang.AddToWishlist}</h2>" +"</div>" +"<div class=\"centerPopup-420-content\">" +"<div class=\"message message-success\">" +"<div class=\"message-wrapper\">" +"<div class=\"message-icon\"></div>" +"<div class=\"message-information\">" +"<span class=\"message-title\"></span>" +"1 item added to " +"{{each list}}" +"<a href=\"${Link}\" class=\"link-blue\">${Title.encodeHtml()}</a>" +"{{if $index + 1 == list.length}}" +"." +"{{else}}" +", " +"{{/if}}" +"{{/each}}" +"</div>" +"</div>" +"</div>" +"<div class=\"item-container\">" +"<div class=\"item-img\">" +"<img src=\"${item.ImageSrc}\">" +"</div>" +"<div class=\"item-info\">" +"<div class=\"item-title\">${item.Description}</div>" +"</div>" +"</div>" +"</div>" +"<div class=\"centerPopup-bottom\">" +"<div class=\"centerPopup-button-area\">" +"<a href=\"javascript:void(0)\" class=\"btn btn-tertiary\">View My Wish Lists</a>" +"<button type=\"button\" class=\"btn btn-primary centerPopup-trigger-close\">Continue Shopping</button>" +"</div>" +"</div>";var createNewBackInfo ="<div class=\"centerPopup-title\">" +"<h2>${lang.AddToWishlist}" +"</div>" +"<div class=\"centerPopup-640-content\">" +"<div class=\"message message-success\">" +"<div class=\"message-wrapper\">" +"<div class=\"message-icon\"></div>" +"<div class=\"message-information\">" +"<span class=\"message-title\"></span>" +"1 item added to " +"<a href=\"${Link}\" class=\"link-blue\">${Title.encodeHtml()}</a>." +"</div>" +"</div>" +"</div>" +"<div class=\"item-container\">" +"<div class=\"item-img\">" +"<img src=\"${item.ImageSrc}\">" +"</div>" +"<div class=\"item-info\">" +"<div class=\"item-title\">${item.Description}</div>" +"</div>" +"</div>" +"</div>" +"<div class=\"centerPopup-bottom\">" +"<div class=\"centerPopup-button-area\">" +"<a href=\"javascript:void(0)\" class=\"btn btn-tertiary\">View My Wish Lists</a>" +"<button type=\"button\" class=\"btn btn-primary centerPopup-trigger-close\">Continue Shopping</button>" +"</div>" +"</div>";var badWords ="<div class=\"centerPopup-420-content\">" +"<div class=\"message message-alert is-vertical\">" +"<div class=\"message-wrapper\">" +"<div class=\"message-icon wishlist-badword\"></div>" +"<div class=\"message-information\">" +"<span class=\"message-title\">An error occurred</span>" +"<p class=\"is-center\">Please accept our apologies but we are unable to post your Wish Lists/Wish List Reviews in its current state because it contains inappropriate content. One or more words found in the text have been deemed improper and unsuitable for submission. Newegg.com will not post Wish Lists/Wish List Reviews that contain obscene and/or potentially offensive language, nor will we allow the inclusion of the names and/or URLs of our competitors. If you feel that your Wish Lists/Wish List Reviews is pertinent and admissible but are unable to successfully submit it online, please forward the text in its entirety along with any other relevant information to our <font face=\"Arial\" size=\"2\" color=\"#CC6600\">" +"<a href=\"mailto:service@newegg.com\">Customer Support</a></font> department to review and evaluate. We appreciate your understanding in this matter and look forward to posting your revised Wish List/Wish List Review to share with our customers.<br><b>Highlighted inappropriate word:</b><br><b>Title:</b>&nbsp;" +"<span>{{html badWords}}</span><br><br></p>" +"<div class=\"form-button-area\">" +"<button class=\"btn centerPopup-trigger-close\">Close</button>" +"</div>" +"</div>" +"</div>" +"</div>" +"</div>";switch (template) {case 'loading':return loading;case 'chooseList':return chooseList;case 'createNew':return createNew;case 'chooseListBackInfo':return chooseListBackInfo;case 'createNewBackInfo':return createNewBackInfo;case 'badWords':return badWords;default:return "";}};var buildRequestData = function () {var list = $.map($(".centerPopup-body .form-exist input:checked"), function (element) {return $(element).val();}).join(",");var hasNewWishList = false;var newTitle = "";if ($(".centerPopup-body .form-add-new input:checked").length == 1) {hasNewWishList = true;var $newTitle = $(".centerPopup-body .form-add-new-text input");newTitle = $newTitle.val() == "" ? "New Wish List" : $newTitle.val();}var requestData = {SubmitType: "AddToWishList",ExistWishListNumber: list,Item: $item_element.data("iteminfo").ItemNumber,Qty: $("#qtyMainItems").val() ? $("#qtyMainItems").val() : 1,HasNewWishList: hasNewWishList,NewCreateTitle: newTitle};return requestData;};var chk_required = function (obj, name_str, err_str) {if (obj == null) obj = 'body';if (err_str == null) err_str = 'This field is required.';if (name_str == null) name_str = '.input:visible, .select:visible';var return_val = true;var obj_str = $(name_str, obj);obj_str.each(function (index, element) {if ($(this).val().trim() == '') {return_val = false;err_msg($(this), err_str);}});return return_val;};var err_msg = function (obj, err_str, err_class) {if (err_class == null) err_class = 'is-error';err_str = $('<span class="form-error-message">' + err_str + '</span>');obj.parent().css('position', 'relative');obj.parent().find('.form-error-message').remove();$(obj).addClass(err_class).bind('keypress', function () {$(this).removeClass(err_class).parent().find('.form-error-message').remove();}).parent().append(err_str);$(obj).addClass(err_class).bind('change', function () {$(this).removeClass(err_class).parent().find('.form-error-message').remove();}).parent().append(err_str);$(obj).parents('.form-cells.form-add-new').find('input:first').on('change', function () {if (!$(this).is(':checked')) {$(obj).removeClass('is-error');$(obj).siblings().remove();}});};var checkLoginState = function () {$("a.wishlist").on("hover", function () {if (!IsLogin) {$(this).removeClass('open-popup');var id = $(this).data('target-id');$("#" + id).remove();$(this).removeAttr('data-target-id');$("#AddToWishlist_Content").remove();$(this).on("click", function () {$("#overlay").remove();window.location.href = Biz.WishListModule.Config.LoginLink;});}});};var api = {Init: init};return api;}return WishList;});NEG.run(function (require) {var $ = require("NEG.ThirdParty.JQuery");var wishList = require("Biz.Common.WishList")();$(document).ready(function () {wishList.Init();});});